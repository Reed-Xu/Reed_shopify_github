{{ 'swiper-bundle.css' | asset_url | stylesheet_tag }}
{{ 'swiper-bundle-slider.css' | asset_url | stylesheet_tag }}
<script src="{{ 'swiper-bundle.js' | asset_url }}" defer></script>  

<div class="swiper-section">
  <div class="swiper-header">
    <h1 class="swiper-title">{{ section.settings.section_title | default: 'Top Picks For You' }}</h1>
  </div>

  <div class="swiper-container">
    <div class="product-swiper">
      <div class="swiper-wrapper">
        {%- comment -%}
        æ ¸å¿ƒæ¸²æŸ“é€»è¾‘ï¼ˆå‚è€ƒproduct-carousel.liquidï¼‰ï¼š
        1. å¦‚æœé…ç½®äº†äº§å“ç³»åˆ—ï¼Œä¼˜å…ˆæ˜¾ç¤ºäº§å“ç³»åˆ—ä¸­çš„äº§å“
        2. å¦‚æœæ²¡æœ‰äº§å“ç³»åˆ—ï¼Œæ˜¾ç¤ºblockä¸­é€‰æ‹©çš„äº§å“
        3. æ”¯æŒè‡ªå®šä¹‰å†…å®¹è¦†ç›–äº§å“é»˜è®¤ä¿¡æ¯
        {%- endcomment -%}
        
        {%- liquid
          assign products_to_show = blank
          assign show_collection = false
          
          comment
          åˆ¤æ–­æ˜¾ç¤ºé€»è¾‘ï¼šä¼˜å…ˆäº§å“ç³»åˆ—ï¼Œå…¶æ¬¡blockäº§å“
          endcomment
          if section.settings.featured_collection != blank
            assign products_to_show = collections[section.settings.featured_collection].products
            assign show_collection = true
          elsif section.blocks.size > 0
            assign products_to_show = section.blocks
            assign show_collection = false
          endif
        -%}
        
        {%- if products_to_show != blank -%}
          {%- if show_collection -%}
            {%- comment -%}
            æ¸²æŸ“äº§å“ç³»åˆ—ä¸­çš„äº§å“
            {%- endcomment -%}
            {%- for product in products_to_show limit: section.settings.products_to_show -%}
              <div class="swiper-slide">
                {%- render 'swiper-product-card', product_card_product: product -%}
              </div>
            {%- endfor -%}
          {%- else -%}
            {%- comment -%}
            æ¸²æŸ“blockä¸­é€‰æ‹©çš„äº§å“
            {%- endcomment -%}
            {%- for block in products_to_show -%}
              {%- if block.settings.featured_product != blank -%}
                <div class="swiper-slide" {{ block.shopify_attributes }}>
                  {%- render 'swiper-product-card', 
                      product_card_product: block.settings.featured_product,
                      custom_tag: block.settings.swiper_tag,
                      custom_image: block.settings.swiper_image,
                      custom_title: block.settings.swiper_title,
                      custom_link: block.settings.link,
                      custom_rating_stars: block.settings.swiper_rating-stars,
                      custom_rating_count: block.settings.swiper_rating-count,
                      custom_current_price: block.settings.swiper_current-price,
                      custom_original_price: block.settings.swiper_original-price
                  -%}
                </div>
              {%- elsif block.type == 'slide' -%}
                {%- comment -%}
                æ¸²æŸ“çº¯è‡ªå®šä¹‰å†…å®¹çš„block
                {%- endcomment -%}
                <div class="swiper-slide" {{ block.shopify_attributes }}>
                  {%- if block.settings.swiper_tag != blank -%}
                    <div class="sale-tag">
                      {{ block.settings.swiper_tag }}
                    </div>
                  {%- endif -%}
                  
                  <div class="swiper-image-container">
                    {%- if block.settings.swiper_image != blank -%}
                      <img
                        src="{{ block.settings.swiper_image | image_url: width: 400 }}"
                        alt="{{ block.settings.swiper_title | default: 'Product Image' }}"
                        class="swiper-image"
                        loading="lazy"
                        width="200"
                        height="180"
                      >
                    {%- else -%}
                      <div class="placeholder-image" style="width: 100%; height: 180px; background-color: #333; display: flex; align-items: center; justify-content: center; color: white;">
                        No Image
                      </div>
                    {%- endif -%}
                  </div>

                  <div>
                    {%- if block.settings.swiper_title != blank -%}
                      {%- if block.settings.link != blank -%}
                        <a href="{{ block.settings.link }}" class="product-name">{{ block.settings.swiper_title }}</a>
                      {%- else -%}
                        <div class="product-name">{{ block.settings.swiper_title }}</div>
                      {%- endif -%}
                    {%- endif -%}
                  </div>
                  
                  {%- if block.settings.swiper_rating-stars != blank or block.settings.swiper_rating-count != blank -%}
                    <div class="rating">
                      {%- if block.settings.swiper_rating-stars != blank -%}
                        <div class="rating-stars">{{ block.settings.swiper_rating-stars }}</div>
                      {%- endif -%}
                      {%- if block.settings.swiper_rating-count != blank -%}
                        <div class="rating-count">{{ block.settings.swiper_rating-count }}</div>
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                  
                  <div class="prices">
                    {%- if block.settings.swiper_current-price != blank -%}
                      <div class="current-price">{{ block.settings.swiper_current-price }}</div>
                    {%- endif -%}
                    {%- if block.settings.swiper_original-price != blank -%}
                      <div class="original-price">{{ block.settings.swiper_original-price }}</div>
                    {%- endif -%}
                  </div>
                  
                  <button class="add-to-cart">Add To Cart</button>
                </div>
              {%- endif -%}
            {%- endfor -%}
          {%- endif -%}
        {%- else -%}
          <div class="swiper-slide">
            <div class="placeholder-content" style="text-align: center; padding: 40px; color: #666;">
              <p>No products to display. Please configure a collection or add product blocks.</p>
            </div>
          </div>
        {%- endif -%}
      </div>
    </div>
    
    <!-- åˆ†é¡µå™¨ç§»åŠ¨åˆ°swiperå®¹å™¨ä¹‹å¤– -->
    {% if section.settings.show_pagination %}
      <div class="swiper-pagination"></div>
    {% endif %}
    
    <!-- å¯¼èˆªæŒ‰é’®ä¿æŒä¸å˜ -->
    {% if section.settings.show_navigation %}
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    {% endif %}
  </div>
</div>

<script>
  // æ·»åŠ åˆ°è´­ç‰©è½¦å‡½æ•°
  function addToCart(variantId, quantity) {
    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        id: variantId,
        quantity: quantity
      })
    })
    .then(response => response.json())
    .then(data => {
      // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æˆåŠŸæç¤º
      console.log('äº§å“å·²æ·»åŠ åˆ°è´­ç‰©è½¦:', data);
      // è§¦å‘è´­ç‰©è½¦æ›´æ–°äº‹ä»¶
      document.dispatchEvent(new CustomEvent('cart:updated'));
    })
    .catch(error => {
      console.error('æ·»åŠ åˆ°è´­ç‰©è½¦å¤±è´¥:', error);
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    // ç¡®ä¿Swiperåº“å·²åŠ è½½
    if (typeof Swiper === 'undefined') {
      console.error('Swiperåº“æœªæ­£ç¡®åŠ è½½');
      return;
    }
    
    // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿DOMå®Œå…¨æ¸²æŸ“ï¼ˆç‰¹åˆ«æ˜¯äº§å“ç³»åˆ—æ¸²æŸ“ï¼‰
    setTimeout(function() {
      // è·å–å¹»ç¯ç‰‡æ•°é‡ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å¯ç”¨loop
      var slides = document.querySelectorAll('.product-swiper .swiper-slide');
      var slideCount = slides.length;
      
      // å¦‚æœæ²¡æœ‰å¹»ç¯ç‰‡ï¼Œä¸åˆå§‹åŒ–Swiper
      if (slideCount === 0) {
        console.log('æ²¡æœ‰å¹»ç¯ç‰‡ï¼Œè·³è¿‡Swiperåˆå§‹åŒ–');
        return;
      }
      
      // åˆå§‹åŒ–Swiperé…ç½®
      var swiperConfig = {
        slidesPerView: 4,
        spaceBetween: 20,
        // åªæœ‰å½“å¹»ç¯ç‰‡æ•°é‡å¤§äºæ˜¾ç¤ºæ•°é‡æ—¶æ‰å¯ç”¨loop
        loop: slideCount > 4,
        autoplay: {
          delay: {{ section.settings.autoplay_speed | times: 1000 }},
          disableOnInteraction: false,
        },
        
        breakpoints: {
          320: {
            slidesPerView: 1,
            spaceBetween: 10
          },
          480: {
            slidesPerView: 2,
            spaceBetween: 15
          },
          768: {
            slidesPerView: 3,
            spaceBetween: 20
          },
          1024: {
            slidesPerView: 4,
            spaceBetween: 20
          }
        },
        
        on: {
          init: function() {
            console.log('Swiperåˆå§‹åŒ–æˆåŠŸ! å¹»ç¯ç‰‡æ•°é‡:', slideCount, 'Loopæ¨¡å¼:', slideCount > 4);
          }
        }
      };
      
      // æ·»åŠ åˆ†é¡µå™¨é…ç½®ï¼ˆå¦‚æœå¯ç”¨ï¼‰
      {% if section.settings.show_pagination %}
      swiperConfig.pagination = {
        el: '.swiper-pagination',
        clickable: true,
        dynamicBullets: false,
      };
      {% endif %}
      
      // æ·»åŠ å¯¼èˆªæŒ‰é’®é…ç½®ï¼ˆå¦‚æœå¯ç”¨ï¼‰
      {% if section.settings.show_navigation %}
      swiperConfig.navigation = {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      };
      {% endif %}
      
      // åˆå§‹åŒ–Swiper
      var swiper = new Swiper('.product-swiper', swiperConfig);
    }, 100); // å»¶è¿Ÿ100msç¡®ä¿DOMå®Œå…¨æ¸²æŸ“
  });
</script>


{% schema %}
{
  "name": "ğŸ”„ Swiper Slider",
  "max_blocks": 10,
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "è½®æ’­æ ‡é¢˜",
      "default": "ç²¾é€‰æ¨è"
    },
    {
      "type": "collection",
      "id": "featured_collection",
      "label": "é€‰æ‹©äº§å“ç³»åˆ—",
      "info": "é€‰æ‹©ä¸€ä¸ªäº§å“ç³»åˆ—ï¼Œå°†è‡ªåŠ¨æ˜¾ç¤ºè¯¥ç³»åˆ—ä¸­çš„äº§å“ã€‚å¦‚æœåŒæ—¶é…ç½®äº†blockï¼Œblocké…ç½®å°†è¦†ç›–ç³»åˆ—äº§å“çš„é»˜è®¤ä¿¡æ¯ã€‚"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "æ˜¾ç¤ºäº§å“æ•°é‡",
      "min": 1,
      "max": 20,
      "step": 1,
      "default": 8,
      "info": "ä»é€‰æ‹©çš„äº§å“ç³»åˆ—ä¸­æ˜¾ç¤ºçš„äº§å“æ•°é‡"
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "è‡ªåŠ¨è½®æ’­é€Ÿåº¦(ç§’)",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 3
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "label": "æ˜¾ç¤ºåˆ†é¡µæŒ‡ç¤ºå™¨",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "æ˜¾ç¤ºå¯¼èˆªç®­å¤´",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "è½®æ’­å¹»ç¯ç‰‡",
      "settings": [
        {
          "type": "product",
          "id": "featured_product",
          "label": "é€‰æ‹©äº§å“",
          "info": "é€‰æ‹©ä¸€ä¸ªäº§å“ï¼Œå°†è‡ªåŠ¨è·å–äº§å“ä¿¡æ¯ã€‚ä¸‹æ–¹çš„è‡ªå®šä¹‰é…ç½®å¯ä»¥è¦†ç›–äº§å“çš„é»˜è®¤ä¿¡æ¯ã€‚"
        },
        {
          "type": "header",
          "content": "è‡ªå®šä¹‰é…ç½®ï¼ˆå¯é€‰ï¼Œå°†è¦†ç›–äº§å“é»˜è®¤ä¿¡æ¯ï¼‰"
        },
        {
          "type": "image_picker",
          "id": "swiper_image",
          "label": "è‡ªå®šä¹‰å›¾ç‰‡",
          "info": "ç•™ç©ºåˆ™ä½¿ç”¨äº§å“ä¸»å›¾ï¼Œå»ºè®®å°ºå¯¸ï¼š400x400px"
        },
        {
          "type": "text",
          "id": "swiper_tag",
          "label": "è‡ªå®šä¹‰æ ‡ç­¾",
          "info": "ç•™ç©ºåˆ™ä¸æ˜¾ç¤ºæ ‡ç­¾",
          "placeholder": "ä¾‹å¦‚ï¼šé™æ—¶ä¼˜æƒ "
        },
        {
          "type": "text",
          "id": "swiper_title",
          "label": "è‡ªå®šä¹‰æ ‡é¢˜",
          "info": "ç•™ç©ºåˆ™ä½¿ç”¨äº§å“åç§°",
          "placeholder": "è‡ªå®šä¹‰äº§å“æ ‡é¢˜"
        },
        {
          "type": "text",
          "id": "swiper_rating-stars",
          "label": "è‡ªå®šä¹‰æ˜Ÿçº§",
          "info": "ç•™ç©ºåˆ™ä¸æ˜¾ç¤ºæ˜Ÿçº§",
          "placeholder": "â˜…â˜…â˜…â˜…â˜…"
        },
        {
          "type": "text",
          "id": "swiper_rating-count",
          "label": "è‡ªå®šä¹‰è¯„ä»·æ•°é‡",
          "info": "ç•™ç©ºåˆ™ä¸æ˜¾ç¤ºè¯„ä»·æ•°é‡",
          "placeholder": "(100)"
        },
        {
          "type": "text",
          "id": "swiper_current-price",
          "label": "è‡ªå®šä¹‰ç°ä»·",
          "info": "ç•™ç©ºåˆ™ä½¿ç”¨äº§å“ä»·æ ¼",
          "placeholder": "$26.39"
        },
        {
          "type": "text",
          "id": "swiper_original-price",
          "label": "è‡ªå®šä¹‰åŸä»·",
          "info": "ç•™ç©ºåˆ™ä½¿ç”¨äº§å“å¯¹æ¯”ä»·æ ¼",
          "placeholder": "$49.99"
        },
        {
          "type": "url",
          "id": "link",
          "label": "é“¾æ¥åœ°å€",
          "info": "ç‚¹å‡»å¹»ç¯ç‰‡è·³è½¬é“¾æ¥"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "ğŸ”„ è½®æ’­å›¾",
      "category": "åª’ä½“"
    }
  ]
}
{% endschema %}